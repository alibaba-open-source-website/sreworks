<!doctype html>
<html lang="zh" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="SREWorks RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="SREWorks Atom Feed">




<meta name="aes-config" content="pid=xux-opensource&amp;user_type=101&amp;uid=&amp;username=&amp;dim10=sreworks">
<link rel="alternate" type="application/rss+xml" href="/zh/column/rss.xml" title="SREWorks RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/column/atom.xml" title="SREWorks Atom Feed"><title data-rh="true">SREWorks v1.5 版本发布 | 基于实时作业平台的日志聚类开源 | SREWorks</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://sreworks.opensource.alibaba.com//zh/blog/zv4i4ovpgtqdhvvc"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="sreworks 官方,sreworks官方文档,SREWorks,SREWorks官网,SRE works,SREworks,srework,srewoks,sreworks,srework,sre文档,sre-works,sre official,sre_works,云原生运维,大数据运维,阿里运维,云原生k8s,智能运维,数智运维,简单运维,高效运维,appmaniger,一站式运维,saas运维"><meta data-rh="true" property="og:title" content="SREWorks v1.5 版本发布 | 基于实时作业平台的日志聚类开源 | SREWorks"><meta data-rh="true" name="description" content="在经过v1.0~v1.4四个版本迭代后，SREWorks的核心底座已经表现出极高的稳定性和成熟性。在v1.5版本中，SREWorks开发团队在核心底座上，进行了较多的数智化能力迭代。同时，在数智能力迭代过程中，我们也维持着与SREWorks用户较高的沟通频率。我们发现大家普遍对于监控数据之上的数智化能力比较关注，于是我们在这些点上做了一些深挖分析，发现普遍都会遇到这样几个问题："><meta data-rh="true" property="og:description" content="在经过v1.0~v1.4四个版本迭代后，SREWorks的核心底座已经表现出极高的稳定性和成熟性。在v1.5版本中，SREWorks开发团队在核心底座上，进行了较多的数智化能力迭代。同时，在数智能力迭代过程中，我们也维持着与SREWorks用户较高的沟通频率。我们发现大家普遍对于监控数据之上的数智化能力比较关注，于是我们在这些点上做了一些深挖分析，发现普遍都会遇到这样几个问题："><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-06-06T07:18:03.000Z"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://sreworks.opensource.alibaba.com//zh/blog/zv4i4ovpgtqdhvvc"><link data-rh="true" rel="alternate" href="https://sreworks.opensource.alibaba.com//blog/zv4i4ovpgtqdhvvc" hreflang="en"><link data-rh="true" rel="alternate" href="https://sreworks.opensource.alibaba.com//zh/blog/zv4i4ovpgtqdhvvc" hreflang="zh"><link data-rh="true" rel="alternate" href="https://sreworks.opensource.alibaba.com//blog/zv4i4ovpgtqdhvvc" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.65d9ebcd.css">
<link rel="preload" href="/zh/assets/js/runtime~main.f2f181cf.js" as="script">
<link rel="preload" href="/zh/assets/js/main.7f2ff021.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>

<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/zh/"><div class="navbar__logo"><img src="/zh/img/sreworks.png" alt="sreworks Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/sreworks.png" alt="sreworks Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SREWorks</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh/docs/iwa896">常见问题</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/blog">博客</a><a class="navbar__item navbar__link" href="/zh/column">专栏</a><a href="https://wj.qq.com/s2/10565748/53da/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">在线体验<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/docs/">v1.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/">Next</a></li><li><a class="dropdown__link" href="/zh/docs/">v1.5</a></li><li><a class="dropdown__link" href="/zh/docs/v1.4/">v1.4</a></li><li><a class="dropdown__link" href="/zh/docs/v1.3/">v1.3</a></li><li><a class="dropdown__link" href="/zh/docs/v1.2/">v1.2</a></li><li><a class="dropdown__link" href="/zh/docs/v1.1/">v1.1</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">简体中文</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="https://sreworks.cn/">简体中文</a></li><li><a class="dropdown__link" href="https://sreworks.opensource.alibaba.com/">English</a></li></ul></div><a href="https://github.com/alibaba/sreworks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/zh/blog/zv4i4ovpgtqdhvvc">SREWorks v1.5 版本发布 | 基于实时作业平台的日志聚类开源</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/zuc6iq93eesusy5r">SREWorks v1.4 版本发布 | 离线安装&amp;前端重构</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/ef445rystzi023ae">SREWorks v1.3 版本发布 | 插件机制发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/ztea5p">基于k8s的云原生数智运维平台SREWorks正式开源</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/dfg57x">SREWorks v1.2 版本发布 | 运维市场能力发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/yot1g3">SREWorks v1.1 版本发布 | 组件插拔场景化部署能力</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">SREWorks v1.5 版本发布 | 基于实时作业平台的日志聚类开源</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-06-06T07:18:03.000Z" itemprop="datePublished">2023年6月6日</time> · <!-- -->阅读需 15 分钟</div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>在经过v1.0~v1.4四个版本迭代后，SREWorks的核心底座已经表现出极高的稳定性和成熟性。在v1.5版本中，SREWorks开发团队在核心底座上，进行了较多的数智化能力迭代。同时，在数智能力迭代过程中，我们也维持着与SREWorks用户较高的沟通频率。我们发现大家普遍对于监控数据之上的数智化能力比较关注，于是我们在这些点上做了一些深挖分析，发现普遍都会遇到这样几个问题：</p><ol><li>自研监控系统在数据体量上升后，可靠性下降。</li><li>日志等各类非结构化的数据引入，导致工程复杂性急剧上升，实时性方面也面临更大的挑战。</li><li>简单的表达式(expression)往往无法满足业务多样化的监控需求。</li></ol><p>于是很多用户选择从自研监控系统切换至流计算引擎Flink，但是Flink Job本身的使用门槛以及运维又成为一大难题。SREWorks开发团队经过多轮的分析研究，决定将这些问题拆成两阶段解决：</p><ol><li><strong>降低Flink Job的使用门槛，赋能SRE将运维需求快速转化为计算力，使SRE能够真正具备touch数据的能力。</strong></li><li><strong>利用SREWorks工程能力构建开源Flink运维产品，进一步降低Flink运维难度。</strong></li></ol><p>在v1.5版本中，我们先将完成阶段1的开源，同时在实时作业平台之上，我们会引入大家呼声较高的<strong>日志聚类作为这种数智能力的最佳实践：通过Flink ML极大地提升海量日志的实时聚合效率。</strong>有关阶段2，近期会披露一篇有关Flink智能诊断利器--Flink Advisor介绍，本文暂不展开。下面先开始阶段1的开源产品：实时作业平台。</p><a name="htUcL"></a><h1>1.  实时作业平台</h1><p>在SREWorks刚开源的一段时间里，因为SREWorks中包含了社区版的Ververica Platform来管理Flink Job，有段时间，社区版vvp的使用答疑居然占据了我们大部分和用户沟通时间。于是经过这些需求的沉淀和打磨，我们将实时处理链路也集成到作业平台中，作业平台中的作业分为定时作业 和 实时作业：</p><ul><li><strong>定时作业</strong>提供分钟级的作业执行调度，适用于小数据量、低时效性的批处理场景。</li><li><strong>实时作业</strong>基于 Flink + 社区版Ververica Platform 提供实时作业管理。</li></ul><p><img loading="lazy" src="/zh/assets/images/1685083532695-e1ef8bc9-602f-40b4-905d-e6aab0b349b8-f2933ba3e39d09af7a870f2cd6e1fc29.jpeg" width="1440" height="339" class="img_ev3q"><br>在收集了大量的用户反馈之后，我们决定将SRE较习惯的Step By Step的步骤型的编排作业能力融合到实时作业中去，进一步降低SRE的使用门槛，最终功能如下图所示：<br><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035910524-0c37ba02-7554-4170-9152-6aa1cf046259-4e002d81a897a99ac4bb8ec07206d2c2.png" width="2772" height="500" class="img_ev3q"><br>我们将一个Flink Job拆成了三种结构便于管理：</p><ul><li><strong>输入源: </strong>对应Flink的Source源，可有多个输入源。</li><li><strong>Python处理</strong>：对应Flink汇总的处理过程，当前基于pyFlink，可直接编写Python脚本，也可以根据业务需求拆分成多个Python处理过程。</li><li><strong>输出：</strong>对应Flink的Sink，可有多个输出。<a name="DSiJm"></a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="输入源输出">输入源&amp;输出<a class="hash-link" href="#输入源输出" title="标题的直接链接">​</a></h2><p>在输入输出这块，我们直接读取Ververica Platform已经注册的Connector供用户选择，以及在配置参数时的下拉提醒，极大地避免用户手写<code>CREATE TABLE</code>时候字段及参数的疏漏。<br><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035911213-78c24db4-b670-445b-a661-67758c0c6064-a077195885d4133a127b791eee949dc8.png" width="2110" height="1270" class="img_ev3q"></p><a name="kCKll"></a><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="运行环境">运行环境<a class="hash-link" href="#运行环境" title="标题的直接链接">​</a></h2><p>常使用Python的同学可以知道，Python运行环境管理是一个比较麻烦的问题：如果使用Docker镜像来管理出包过程过于冗长，如果使用requirements来进行管理又常常会遇到包装不上的问题。于是实时作业平台中，我们做了一个折中的处理，使用Python虚拟环境来进行管理。<br><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035910582-07fabc17-be20-4840-808e-80816e5ecc37-1b987e0e71d1aef006fbc1d2ca5853ea.png" width="2070" height="764" class="img_ev3q"><br><img loading="lazy" src="/zh/assets/images/1685138906494-583ac7dc-8a47-494e-9afa-3a450aee8dba-5f8dbcb044871ad218b400b7e8b1d033.jpeg" width="1572" height="1066" class="img_ev3q"><br>同时，我们也对环境这个概念进行了组合化的扩展：<strong>Flink的容器镜像、PyFlink的运行时Jar包</strong>等一系列的对象，都算作环境中的设置。由于环境收敛了所有的可变资源，大大降低SRE维护作业的复杂度，原本多个运行时资源间版本不兼容的问题一去不复返，所有同一环境作业，都使用同一组合。<br>当前v1.5提供两个环境可用：flink-ml 和 default，环境的自主管理能力会在下个版本上线。</p><a name="TzbEy"></a><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="flink作业运维">Flink作业运维<a class="hash-link" href="#flink作业运维" title="标题的直接链接">​</a></h2><p>实时作业平台做了较多抽象，简化了作业提交的流程，但在Flink作业运维上我们深知其中的复杂度，并没有额外做过多的包装，直接使用Flink Dashboard作为运行中的观测平台，方便熟悉Flink的同学快速上手排查问题。下图为实时作业平台中启动作业的Flink Dashboard页面：<br><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035914376-6521263b-d3fc-40b7-aec8-aad3d124abbd-ab1449c6f484bcab9efba35d7bdba830.png" width="2988" height="1654" class="img_ev3q"></p><a name="KmzlE"></a><h1>2.  日志聚类</h1><p>在实时作业平台之上，本次v1.5版本同时开源了日志聚类算法，有关算法原理可以参考《基于Flink ML搭建的智能运维算法服务及应用》，本文主要阐述开源工程实践。<br>日志聚类的算法代码位于目录 <code>https://github.com/alibaba/SREWorks/tree/master/saas/aiops/api/log-clustering</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">├── db-init.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── log-clustering-job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── pythons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── log_cluster_pattern.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── settings.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── sinks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── pattern_output.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── sources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── log_input.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── template.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>目录主要由两部分组成：</p><ul><li><code>db-init.py</code>：特征工程的数据库初始化，需要用少量典型的日志样本初始化日志关键词列表以及日志样板特征。</li><li><code>log-clustering-job/*</code>：日志聚类算法作业，在v1.5版本中已默认导入至作业平台中，手工将其打成zip包导入亦能实现相同的效果。</li></ul><p>下面我们基于这个开源工程，完成一次完整的日志聚类的实践。本次实践的输入为kafka（SREWorks内置的kafka）的日志流，输出为MySQL中的特征库。<br><img loading="lazy" src="/zh/assets/images/1685092025363-8b3c20d4-35af-4bde-81e6-64b2d430575a-ab25dd49027ccd51a85b6487a7eee1cc.jpeg" width="1911" height="962" class="img_ev3q"></p><a name="oyuav"></a><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-1-特征工程初始化">STEP 1 特征工程初始化<a class="hash-link" href="#step-1-特征工程初始化" title="标题的直接链接">​</a></h2><p>我们本次实践以SREWorks中应用引擎（AppManager）日志为例：<br>先用标签<code>name=sreworks-appmanager-server</code>查询出AppManager Pod的名称，这个标签在后面采集的时候还会被用到。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -l </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sreworks-appmanager-server -n sreworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sreworks-appmanager-server-c9b6c7776-m98wn   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          5h39m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后提取该Pod的少量日志作为初始化日志样本，存储文件名为 <code>example.log</code>。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs --tail</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> sreworks-appmanager-server-c9b6c7776-m98wn -n sreworks </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> example.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>example.log</code>里面日志的内容大概是这样：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">-05-26 </span><span class="token number" style="color:#36acaa">21</span><span class="token plain">:46:02 </span><span class="token number" style="color:#36acaa">525</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DEBUG </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">http-nio-7001-exec-6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">o.s.web.servlet.DispatcherServlet:119</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">- GET </span><span class="token string" style="color:#e3116c">&quot;/realtime/app-instances?stageIdList=prod&amp;appId=&amp;clusterId=1id&amp;optionKey=source&amp;optionValue=app&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">parameters</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">masked</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">-05-26 </span><span class="token number" style="color:#36acaa">21</span><span class="token plain">:46:02 </span><span class="token number" style="color:#36acaa">526</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DEBUG </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">http-nio-7001-exec-6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">o.s.w.s.m.m.a.RequestMappingHandlerMapping:522</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">- Mapped to com.alibaba.tesla.appmanager.server.controller.RtAppInstanceController</span><span class="token comment" style="color:#999988;font-style:italic">#list(RtAppInstanceQueryReq, HttpServletRequest, OAuth2Authentication)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">-05-26 </span><span class="token number" style="color:#36acaa">21</span><span class="token plain">:46:02 </span><span class="token number" style="color:#36acaa">527</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DEBUG </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">http-nio-7001-exec-6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor:268</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">- Using </span><span class="token string" style="color:#e3116c">&#x27;application/json&#x27;</span><span class="token plain">, given </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*/*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> and supported </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">application/json, application/*+json</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">-05-26 </span><span class="token number" style="color:#36acaa">21</span><span class="token plain">:46:02 </span><span class="token number" style="color:#36acaa">527</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DEBUG </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">http-nio-7001-exec-6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor:119</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">- Writing </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TeslaBaseResult</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">200</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">message</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SUCCESS, </span><span class="token assign-left variable" style="color:#36acaa">requestId</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">null, </span><span class="token assign-left variable" style="color:#36acaa">timestamp</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1685137562527</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Pagination</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">truncated</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2023</span><span class="token plain">-05-26 </span><span class="token number" style="color:#36acaa">21</span><span class="token plain">:46:02 </span><span class="token number" style="color:#36acaa">527</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> DEBUG </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">http-nio-7001-exec-6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">o.s.web.servlet.DispatcherServlet:1131</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">- Completed </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> 使用 db-init.py 进行特征工程数据库初始化，该动作会在数据库中增加一张表，并且将 <code>example.log</code>中的日志处理成特征行存入表中：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 ./db-init.py example.log --host *** --user *** --password *** --database *** --table ***</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个数据库的连接变量记一下，在下一步中马上就会用到。</p><a name="NjoSa"></a><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-2-作业参数运行配置并启动">STEP 2 作业参数运行配置并启动<a class="hash-link" href="#step-2-作业参数运行配置并启动" title="标题的直接链接">​</a></h2><p>打开SREWorks中的实时作业平台，点开《日志聚类模式提取》这个作业对应的【运行参数】按钮，在启动参数中，将STEP1 中数据库连接参数填入：<br><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035911807-73b5aac9-0ff6-488a-9f06-5f04f595e580-a5af2ec2a9b8abdd2382ad4b757c50e0.png" width="2908" height="1342" class="img_ev3q"><br>填写完成后，我们可以直接点击作业启动。作业启动后，我们点击【运行中】的状态可以直接跳转到Flink Dashboard看到整个流计算处理链路已经准备就绪，但还没有日志输入。<br><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035915015-f17550af-f1e8-408c-9b27-ab859cd75daf-7c4a7f1f1cea5924eb5990657a80f81e.png" width="2974" height="1996" class="img_ev3q"></p><a name="vtBXe"></a><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-3-日志采集输入并聚类">STEP 3 日志采集输入并聚类<a class="hash-link" href="#step-3-日志采集输入并聚类" title="标题的直接链接">​</a></h2><p>ilogtail是阿里云开源的可观测工具，在阿里云的采集场景中有着非常广泛的应用。ilogtail对于云原生的适配也非常好，采用DaemonSet的方式在每个Node中拉起，Pod中只要包含对应的label就会对其进行采集。<br>于是，我们可以通过运维市场，非常方便地将ilogtail安装进集群，同时安装的时候，对应的采集label配置为<code>name=sreworks-appmanager-server</code>即是对应用引擎（AppManager）进行日志采集。<br><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035913293-44fda8a1-2b1c-419d-97bb-f13a11471e6f-5d2b1f4ee415db1f27618e6486bbd7d0.png" width="906" height="488" class="img_ev3q"><br>在日志采集运行起来之后，通过Flink Dashboard我们可以看到原本空空的实时处理链路一下子就繁忙了起来，像一个工厂的流水线一样，每个运算单元都在不断地收发处理数据。<br><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035915874-a3f23fe6-8f60-4cb8-8ed9-f821eb18f7b4-b6af5851dab454b2b3ac93d5bdd84b8a.png" width="2862" height="1866" class="img_ev3q"><br>通过查看MySQL中的特征(pattern)表，我们可以看到日志特征处理完之后已经被落到了我们在STEP 2中定义的MySQL表中。<img loading="lazy" alt="image.png" src="/zh/assets/images/1686035915828-80529703-143d-4311-9b6e-7431ee6bddde-f1cc1df67c18952d6d69818ec2992618.png" width="2126" height="1126" class="img_ev3q"><br>特征表中的几个关键点我们可以关注一下：</p><ul><li>特征表为日志的特征收敛，在初期数据量会迅速扩大，经过一段时间后，当没有新的特征之后，数据量会趋于平稳。</li><li>特征表中的字段 <code>pattern</code> 为这行日志的摘要，字段 <code>top_pattern</code> 为聚类后处于中心的日志摘要，通过 <code>top_pattern</code>我们可以很方便地统计出总共有几类日志，也可以看出每一类日志下有哪些日志。</li></ul><p>如下图可以看到这些文本非常相似但又不同的debug日志，被聚到了同一个 <code>top_pattern</code> 下。<br><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035915577-2137c4e4-7815-4c74-99e2-48c57995e186-e906cfed2c03c4982a752eda615303e4.png" width="2482" height="610" class="img_ev3q"></p><a name="Mmjqw"></a><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="日志聚类的实践应用">日志聚类的实践应用<a class="hash-link" href="#日志聚类的实践应用" title="标题的直接链接">​</a></h2><p>围绕日志聚类算法，可以展开很多数智化的实践。围绕《基于Flink ML搭建的智能运维算法服务及应用》已披露的案例，结合着上文的工程实践，我们可以再来看一下完整的链路：<br><img loading="lazy" src="/zh/assets/images/1685313672135-a0ab7a62-a75e-4022-9be9-f63669729ddf-1a469b93d509a114c643431e46376be7.jpeg" width="2040" height="857" class="img_ev3q"></p><ul><li>STEP 3中我们查看的特征(pattern)表可以进一步演进为一个日志知识库，引导SRE结合运维经验来进行标注。</li><li>日志知识库沉淀的日志输入答疑机器人作为答疑语料，快速解决用户问题，降低工单数量。</li></ul><p>期待大家集成并使用日志聚类算法之后的反馈，同时SREWorks团队也会根据内部的运行效果和大家的反馈，持续打磨数智运维算法。</p><a name="DG541"></a><h1>3.  企业应用开发部署增强</h1><p>在v1.5版本中，我们同样对底座的应用开发能力进行了增强，包含以下这些功能点：</p><ul><li>企业应用增加多分支开发能力，适配企业的多版本迭代需求。</li><li>企业应用实例部署完整的OAM可视化。</li></ul><p><img loading="lazy" alt="image.png" src="/zh/assets/images/1686035916869-3b522968-9def-4d7d-a972-149e9239a391-f8211be8fcf48d53cb8486e36ed1599d.png" width="2474" height="654" class="img_ev3q"><br>在企业应用上，我们常常结合SREWorks一线用户的声音，将内部使用的强大能力通过产品化的打磨优化，提供给SREWorks的用户们。我们也会保持这种状态，期望云原生的应用开发模式和数智运维体系，能够助力企业聚焦业务价值，进行快速的功能产品发展迭代。</p><a name="Of6ou"></a><h1>如何从当前版本升级到v1.5</h1><ul><li>升级包含底座，页面可能会有5-10分钟的不可访问，请注意。</li><li>用户自行开发的云原生应用不会受影响(不重启)，SREWorks网关到应用的流量会有中断。</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone http://github.com/alibaba/sreworks.git -b v1.5 sreworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd sreworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./sbin/upgrade-cluster.sh --kubeconfig=&quot;****&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如在使用过程中遇到问题，欢迎各位在GitHub中提出Issues或Pull requests。<br>SREWorks开源地址：<a href="https://github.com/alibaba/sreworks" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/sreworks</a></p><p>也欢迎各位加入钉钉群（群号：35853026）分享和交流～</p><p><em>v1.5版本感谢 Flink ML  和 PyFlink 团队在日志聚类工程开源落地过程中给予的大力支持。</em></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--next" href="/zh/blog/zuc6iq93eesusy5r"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">SREWorks v1.4 版本发布 | 离线安装&amp;前端重构</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#输入源输出" class="table-of-contents__link toc-highlight">输入源&amp;输出</a></li><li><a href="#运行环境" class="table-of-contents__link toc-highlight">运行环境</a></li><li><a href="#flink作业运维" class="table-of-contents__link toc-highlight">Flink作业运维</a></li><li><a href="#step-1-特征工程初始化" class="table-of-contents__link toc-highlight">STEP 1 特征工程初始化</a></li><li><a href="#step-2-作业参数运行配置并启动" class="table-of-contents__link toc-highlight">STEP 2 作业参数运行配置并启动</a></li><li><a href="#step-3-日志采集输入并聚类" class="table-of-contents__link toc-highlight">STEP 3 日志采集输入并聚类</a></li><li><a href="#日志聚类的实践应用" class="table-of-contents__link toc-highlight">日志聚类的实践应用</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/rr5g10">快速安装</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/eg91va">核心思想</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/cirgod">数智运维</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/alibaba/sreworks/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><div class="wechat"> <span class="wechat-label">钉钉交流群</span> <a class="wechat-img" rel="noreferrer noopener" aria-label="DingTalk Group"><img src="https://sreworks.oss-cn-beijing.aliyuncs.com/logo/ding.jpg"></a></div></li><li class="footer__item"><div class="wechat"> <span class="wechat-label">微信交流群</span> <a class="wechat-img" rel="noreferrer noopener" aria-label="Wechat Group"><img src="https://sreworks.oss-cn-beijing.aliyuncs.com/logo/weixin-helper.jpg" alt="Broker wechat to add you into the user group."></a></div></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 SREWorks | ICP备案网站信息: <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备12022327号</a></div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.f2f181cf.js"></script>
<script src="/zh/assets/js/main.7f2ff021.js"></script>
</body>
</html>